CREATE DATABASE ProjectFinalV2;
USE ProjectFinalV2;
SET LANGUAGE us_english;


CREATE TABLE EMPLOYEE(
   id INT PRIMARY KEY IDENTITY,
   [user] VARCHAR(50) NOT NULL,
   [password] VARCHAR(50) NOT NULL,
   [name] VARCHAR(50) NOT NULL,
   [email] VARCHAR(50) NOT NULL,
   [address] VARCHAR(50) NOT NULL,
   id_type INT NOT NULL,
   id_cabin INT NOT NULL
);

CREATE TABLE CABIN(
  id INT PRIMARY KEY IDENTITY,
  [address] VARCHAR(50) NOT NULL,
  [phone] VARCHAR(50) NOT NULL CHECK ( [phone] >= 60000000 AND 79999999 >= [phone]),
  [email] VARCHAR(50) NOT NULL
);

CREATE TABLE [SESSION](
  id INT PRIMARY KEY IDENTITY,
  [datetime] DATETIME NOT NULL CHECK (DATEPART(HOUR,[datetime]) < 18 AND DATEPART(HOUR,[datetime]) > 8),
  id_employee INT NOT NULL,
  id_cabin INT NOT NULL
);

CREATE TABLE APPOINTMENT(
  id INT PRIMARY KEY IDENTITY,
  [datetime] DATETIME NOT NULL CHECK (DATEPART(HOUR,[datetime]) < 18 AND DATEPART(HOUR,[datetime]) > 8),
  id_place INT NOT NULL,
  id_employee INT NOT NULL,
  dui_citizen VARCHAR(9) NOT NULL,
);

CREATE TABLE CITIZEN(
  dui VARCHAR(9) PRIMARY KEY CHECK (dui LIKE '[0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]'),
  [name]  VARCHAR(50) NOT NULL,
  [phone]  VARCHAR(50) NOT NULL CHECK ( [phone] >= 60000000 AND 79999999 >= [phone]),
  [email] VARCHAR(50) NULL DEFAULT 'No posee correo electrónico',
  [address] VARCHAR(50) NOT NULL,
  id_institution INT NOT NULL,
  id_group INT NOT NULL
);

CREATE TABLE PROCESS_VACCINATION(
  id INT PRIMARY KEY IDENTITY,
  datetime_registered DATETIME NOT NULL CHECK (DATEPART(HOUR, datetime_registered) < 18 AND DATEPART(HOUR, datetime_registered) > 8),
  datetime_initiation DATETIME NOT NULL CHECK (DATEPART(HOUR, datetime_initiation) < 18 AND DATEPART(HOUR, datetime_initiation) > 8),
  datetime_vaccine DATETIME NOT NULL CHECK (DATEPART(HOUR, datetime_vaccine) < 18 AND DATEPART(HOUR, datetime_vaccine) > 8),
  time_effect INT NOT NULL CHECK (time_effect >= 0 AND time_effect <= 30)
);

CREATE TABLE PROCESSXCITIZEN(
  id_citizen VARCHAR(9) NOT NULL,
  id_process INT NOT NULL,
  CONSTRAINT PK_PROCESSXCITIZEN PRIMARY KEY (id_citizen,id_process)
);

CREATE TABLE INSTITUTION(
  id INT PRIMARY KEY IDENTITY,
  institution VARCHAR(50) NOT NULL
);

CREATE TABLE [GROUP](
  id INT PRIMARY KEY IDENTITY,
  [group] VARCHAR(100) NOT NULL
);

CREATE TABLE PLACE(
  id INT PRIMARY KEY IDENTITY,
  place VARCHAR(50) NOT NULL
);

CREATE TABLE [TYPE](
  id INT PRIMARY KEY IDENTITY,
  [type] VARCHAR(50) NOT NULL
);

ALTER TABLE EMPLOYEE ADD FOREIGN KEY (id_cabin) REFERENCES CABIN (id);
ALTER TABLE [SESSION] ADD FOREIGN KEY (id_employee) REFERENCES EMPLOYEE (id);
ALTER TABLE [SESSION] ADD FOREIGN KEY (id_cabin) REFERENCES CABIN (id);
ALTER TABLE APPOINTMENT ADD FOREIGN KEY (id_employee) REFERENCES EMPLOYEE (id);
ALTER TABLE APPOINTMENT ADD FOREIGN KEY (dui_citizen) REFERENCES CITIZEN (dui);
ALTER TABLE CITIZEN ADD FOREIGN KEY (id_institution) REFERENCES INSTITUTION (id);
ALTER TABLE CITIZEN ADD FOREIGN KEY (id_group) REFERENCES [GROUP] (id);
ALTER TABLE APPOINTMENT ADD FOREIGN KEY (id_place) REFERENCES PLACE (id);
ALTER TABLE [EMPLOYEE] ADD FOREIGN KEY (id_type) REFERENCES [TYPE] (id);
--Tabla cruz
ALTER TABLE PROCESSXCITIZEN ADD FOREIGN KEY (id_citizen) REFERENCES CITIZEN (dui);
ALTER TABLE PROCESSXCITIZEN ADD FOREIGN KEY (id_process) REFERENCES PROCESS_VACCINATION (id);


-- Poblando tablas catalogo
INSERT INTO PLACE VALUES ('C.C La Gran Via');
INSERT INTO PLACE VALUES ('Hospital Nacional de la Mujer');
INSERT INTO PLACE VALUES ('Hospital El Salvador');
INSERT INTO PLACE VALUES ('Unidad de Salud de San Jacinto');
INSERT INTO PLACE VALUES ('Unidad de Salud Barrios');

INSERT INTO INSTITUTION VALUES ('Educacion');
INSERT INTO INSTITUTION VALUES ('Salud');
INSERT INTO INSTITUTION VALUES ('Policia Nacional Civil');
INSERT INTO INSTITUTION VALUES ('Gobierno');
INSERT INTO INSTITUTION VALUES ('Fuerza Armada');
INSERT INTO INSTITUTION VALUES ('Otros');

INSERT INTO [GROUP] VALUES ('Adultos mayores de 60 años');
INSERT INTO [GROUP] VALUES ('Personal del sistema integrado de salud');
INSERT INTO [GROUP] VALUES ('Encargados de la Seguridad Nacional');
INSERT INTO [GROUP] VALUES ('Personas mayores de 18 años con enfermades no transmisibles');
INSERT INTO [GROUP] VALUES ('Personal del Gobierno Central');
INSERT INTO [GROUP] VALUES ('Otros');

INSERT INTO [TYPE] VALUES ('Gestor');
INSERT INTO [TYPE] VALUES ('Encargado de cabina');
INSERT INTO [TYPE] VALUES ('Otros');

-- Datos ejemplos en las demas tablas
INSERT INTO CABIN VALUES ('1710 Packers Center', 77965340, 'aconyers0@list-manage.com');
INSERT INTO CABIN VALUES ('0933 Transport Court', 78438346, 'dclayill1@engadget.com');
INSERT INTO CABIN VALUES ('3 Sugar Trail', 66703344, 'fscriviner2@ovh.net');
INSERT INTO CABIN VALUES ('0888 Washington Street', 65653200, 'fcollyns3@mapquest.com');
INSERT INTO CABIN VALUES ('864 Park Meadow Parkway', 78792610, 'kgange4@cmu.edu');
INSERT INTO CABIN VALUES ('91 Mockingbird Park', 76995353, 'ldrakes5@wikipedia.org');
INSERT INTO CABIN VALUES ('07 Del Sol Pass', 78782766, 'bbryers6@hatena.ne.jp');
INSERT INTO CABIN VALUES ('4 Jenifer Center', 75918352, 'cbardill7@huffingtonpost.com');

INSERT INTO CITIZEN VALUES ('947284759', 'Brande Carrel', 63484911, 'bcarrel0@jiathis.com', '2899 Wayridge Way',1,5);
INSERT INTO CITIZEN VALUES ('097643216', 'Felice Risbridger', 74840781, 'frisbridger1@moonfruit.com', '08220 American Ash Parkway',2,3);
INSERT INTO CITIZEN VALUES ('983664789', 'Chance Bayman', 73433487, 'cbayman2@npr.org', '99249 Dixon Road',4,5);
INSERT INTO CITIZEN VALUES ('856245674', 'Nicole Zanettini', 67248897, 'nzanettini3@nationalgeographic.com', '08 Burning Wood Pass',3,1);
INSERT INTO CITIZEN VALUES ('236789045', 'Elladine Wheildon', 71123727, 'ewheildon4@google.es', '6208 Porter Parkway',5,2);
INSERT INTO CITIZEN VALUES ('145678345', 'Skip Whitnell', 72809422, 'swhitnell5@forbes.com', '08 Mesta Parkway',6,4);
INSERT INTO CITIZEN VALUES ('456324567', 'Sayre Langstone', 77688730, 'slangstone6@google.es', '7 Heath Parkway',6,5);
INSERT INTO CITIZEN VALUES ('345672345', 'Nonah Tillard', 77167757, 'ntillard7@psu.edu', '9 Riverside Lane',6,2);

INSERT INTO EMPLOYEE VALUES ('bleijs0', 'hp9Z1zZ', 'Base Parks', 'bblackham0@liveinternet.ru', '35 Novick Crossing', 1 , 1);
INSERT INTO EMPLOYEE VALUES ('lfleming1', 'SEWHSLIpq', 'Livvie James', 'ltabor1@pinterest.com', '67 Vahlen Road', 2 , 4);
INSERT INTO EMPLOYEE VALUES ('tcorner2', 'y0tJ6mJbiK', 'Thedric Holsen', 'tfass2@ezinearticles.com', '2608 Carberry Avenue', 3 , 6);
INSERT INTO EMPLOYEE VALUES ('stenaunt3', 'ndFPHYjgqn3', 'Shawna Smith', 'sgavaran3@cpanel.net', '6 Union Terrace', 2, 7);
INSERT INTO EMPLOYEE VALUES ('jbattisson4', 'FUTmaPBl', 'Jason Derulo', 'jbaxster4@stumbleupon.com', '391 Oak Drive', 2, 6);
INSERT INTO EMPLOYEE VALUES ('atillett5', 'G9FQjqKRNt', 'Alvira Torres', 'agosnoll5@comcast.net', '5 Texas Lane', 2, 8);
INSERT INTO EMPLOYEE VALUES ('jlicciardiello6', '9Qv3Dlbn', 'Jorrie Jordan', 'jmcilwreath6@technorati.com', '33 Basil Plaza', 3, 7);
INSERT INTO EMPLOYEE VALUES ('hnisuis7', '48mBNo1LP', 'Henrie Thompson', 'hivimy7@springer.com', '2 Morrow Lane', 1, 8);
INSERT INTO EMPLOYEE VALUES ('ambo06', 'obma60', 'Ada Bonilla', '00048020@uca.edu.sv', 'La Zacarraca', 1,6);
INSERT INTO EMPLOYEE VALUES ('delmy22', 'abigail22', 'Delmy Cardoza', '00212120@uca.edu.sv', 'Los planes de renderos', 1,4);
INSERT INTO EMPLOYEE VALUES ('xiomara64', '1234', 'Xiomara Carranza', '00035420@uca.edu.sv', 'La cima 1',1,7);
INSERT INTO EMPLOYEE VALUES ('ErickV', 'ABCD', 'Erick Varela', '00820400@uca.edu.sv', 'Bulevar los proceres', 1,5);
INSERT INTO EMPLOYEE VALUES ('boris4', 'bushiidoo', 'Boris Campos', '00024020@uca.edu.sv', 'Santa tecla', 1,4);

INSERT INTO APPOINTMENT VALUES('2021-04-12 11:03:44', 2, 1, '947284759');
INSERT INTO APPOINTMENT VALUES('2021-04-12 09:03:44', 5, 3, '097643216');
INSERT INTO APPOINTMENT VALUES('2021-04-12 10:03:44', 2, 4, '983664789');
INSERT INTO APPOINTMENT VALUES('2021-04-12 16:03:44', 2, 4, '856245674');
INSERT INTO APPOINTMENT VALUES('2021-04-12 17:03:44', 2, 3, '145678345');
INSERT INTO APPOINTMENT VALUES('2021-04-12 15:03:44', 1, 2, '345672345');
INSERT INTO APPOINTMENT VALUES('2021-04-12 14:03:44', 2, 4, '456324567');
INSERT INTO APPOINTMENT VALUES('2021-04-12 13:03:44', 2, 4, '456324567');

INSERT INTO [SESSION] VALUES('2021-04-12 11:03:44', 2, 1);
INSERT INTO [SESSION] VALUES('2021-04-12 12:03:44', 3, 2);
INSERT INTO [SESSION] VALUES('2021-04-12 13:03:44', 4, 5);
INSERT INTO [SESSION] VALUES('2021-04-12 14:03:44', 5, 4);
INSERT INTO [SESSION] VALUES('2021-04-12 16:03:44', 3, 2);
INSERT INTO [SESSION] VALUES('2021-04-12 15:03:44', 2, 3);
INSERT INTO [SESSION] VALUES('2021-04-12 17:03:44', 3, 5);
INSERT INTO [SESSION] VALUES('2021-04-12 13:03:44', 1, 6);

INSERT INTO PROCESS_VACCINATION VALUES ('2021-03-09 11:03:23', '2021-03-02 09:15:48', '2021-03-07 11:03:14', 10);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-03-23 09:20:07', '2021-03-17 16:29:52', '2021-03-15 13:17:23', 14);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-03-03 13:16:26', '2021-05-29 13:05:45', '2021-03-25 09:22:32', 16);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-05-04 13:13:34', '2021-05-14 13:42:27', '2021-05-03 14:00:55', 18);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-06-09 12:34:17', '2021-03-11 15:35:18', '2021-04-02 14:47:05', 29);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-05-26 12:25:47', '2021-03-09 13:05:38', '2021-05-08 14:28:20', 30);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-04-04 09:38:05', '2021-06-18 11:41:54', '2021-06-02 13:19:54', 17);
INSERT INTO PROCESS_VACCINATION VALUES ('2021-04-24 09:01:19', '2021-04-01 11:21:17', '2021-06-06 14:42:52', 9);

INSERT INTO PROCESSXCITIZEN VALUES ('947284759', 1);
INSERT INTO PROCESSXCITIZEN VALUES ('097643216', 2);
INSERT INTO PROCESSXCITIZEN VALUES ('983664789', 3);
INSERT INTO PROCESSXCITIZEN VALUES ('856245674', 4);
INSERT INTO PROCESSXCITIZEN VALUES ('236789045', 5);
INSERT INTO PROCESSXCITIZEN VALUES ('145678345', 6);
